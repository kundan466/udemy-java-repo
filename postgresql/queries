--orders shipping to usa or france

select * from orders
order by ship_country;

select* from orders 
where ship_country='USA' or ship_country='France'


--count total no of orders shipping to usa or france

select ship_country,count(*) from orders 
where ship_country='USA' or ship_country='France'
group by ship_country

--order shpping to any countries within latin america

select * from orders
where ship_country in ('Brazil','Mexico','Argentina','Venezuela')
order by ship_country

--show order total amount per each order line

total amount=(unit_price*quantity)-discount

select order_id,product_id,unit_price,quantity,discount,
		((unit_price*quantity)-discount) as total_order_amount
from order_details;

--find the first and latest order dates?

select 
	min(order_date) as min_order,
	max(order_date) as max_order
from orders

--total products in each categories

select
	c.category_name,
	count(*) as total_products
from products p
inner join categories c on c.category_id=p.category_id
group by 1
order by 2 desc

--list products that needs re-ordering

select product_id,product_name,units_in_stock,reorder_level
from products
where units_in_stock<=reorder_level
order by 1

--list top 5 heighest freight chargers

select
	ship_country,
	max(freight)
from orders
group by ship_country
order by 2 desc
limit 5

--list top 5 highest freight charges in year 1997 

select
	ship_country,
	max(freight)
from orders
where order_date between ('1997-01-01') and ('1997-12-31')
group by ship_country
order by 2 desc
limit 5

--list top 5 highest freight charges last year

select
	ship_country,
	max(freight)
from orders
where 
	Extract('Y' from order_date)>=extract('Y' from(select max(order_date) from orders)) 
group by ship_country
order by 2 desc
limit 5

--customers with no orders
select
	*
from customers c
left join orders o on o.customer_id=c.customer_id
where o.customer_id is NULL

--top customers with their total order amount spend


select 
	c.customer_id,
	c.company_name,
	sum((od.unit_price*od.quantity)-od.discount) as total_amount
from customers c
join orders o on o.customer_id=c.customer_id
join order_details od on od.order_id=o.order_id
group by c.customer_id,c.company_name
order by 3 desc
limit 10


--orders with many line of items

select 
	order_id,
	count(*)
from order_details
group by order_id
order by 2 desc
limit 10
--orders with double entry line items(qty>60)

select 
	order_id,quantity
from order_details
where quantity>60
group by order_id,quantity
having count(*)>1
order by order_id

--lets get the details of the items too
with duplicate_entries as 
(
select order_id,quantity
from order_details
where quantity>60
group by order_id,quantity
having count(*)>1
order by order_id
)
select 
*
from order_details
where order_id in (select order_id from duplicates_entries)
order by order_id

--list all late shipped orders
select 
*
from orders
where shipped_date>required_date

--list employees with late shipped orders
with late_orders as(select 
employee_id,count(*) as total_late_orders
from orders
where shipped_date>required_date
				   group by employee_id),
all_orders as(
select employee_id,
	count(*)as total_orders
from orders
group by employee_id)


select 
	employees.employee_id,
	employees.first_name,
	all_orders.total_orders,
	late_orders.total_late_orders
from employees
join all_orders on all_orders.employee_id=employees.employee_id
join late_orders on late_orders.employee_id=employees.employee_id

--countries with customers or suppliers
select country 
from customers

union all

select country
from suppliers order by country
--using CTE
with countries_suppliers as(
	select distinct country from suppliers
),
countries_customers as(
select distinct country from customers
)
select
	countries_suppliers.country as country_suppliers,
	countries_customers.country as country_customers
	from countries_suppliers
	full join countries_customers on countries_customers.country=countries_suppliers.country


--customers with multiple orders
--say within 4days period

with next_order_date as(
select 
	customer_id,order_date,lead(order_date,1)over(partition by customer_id order by customer_id,order_date) as next_order_date
	from orders
)
select
customer_id,order_date,next_order_date,
(next_order_date-order_date)as days_btw_orders
from next_order_date
where (next_order_date-order_date)<=4

--first order from each country

with orders_by_country as
(
	select 
		ship_country,order_id,order_date,row_number()over(partition by ship_country order by ship_country,order_date) country_row_number
	from orders
)
select 
ship_country,order_id,order_date
from orders_by_country
where country_row_number=1
 --get the highest,lowest,total and avg salary of all employees

select 
	ROUND(max(salary),2) as "Max salary",
	ROUND(min(salary),2) as "Min salary",
	ROUND(sum(salary),2) as "total salary",
	ROUND(avg(salary),2) as "Average salary"
from employees

--query to get the difference between thr highest and lowest salary
--function:max,min and ?

select
	max(salary),
	min(salary),
	max(salary)-min(salary) as "difference"
from employees
group by job_id

--query to lowest-paid salary paid by each manager_id
select manager_id,min(salary),salary
from employees
where manager_id is not null
and manager_id!=0

--avg salary for each department with more than 10 employees

select department_id,
ROUND(avg(salary),0),
count(*) as "total_employees"
from employees 
group by department_id
order by 3 desc

--query to get avg salary for each post excluding programmer(IT_PROG)
select
	job_id,
	avg(salary)
from employees
where job_id<>'IT_PROG'
group by job_id

--query to list max salary of each point for max salary is at or above 5000dollars

select job_id,
	max(salary)
from employees
group by job_id
having max(salary)>5000


--display employees name(first_name,last_name) using alais name first name and last name

select first_name as "FirstName",
last_name as "LastName"
from employees


--get the names ,salary and calculate 15% of salary for all employees

select first_name,last_name,salary,salary*.15 as salary_15per
from employees
order by 4 desc


--query to get the job_id and all the employees id within each job_id group

select job_id,array_agg(employee_id)
from employees
group by job_id


--get all employees,and discard the last four characters from email

select first_name,email,length(email),substr(email,1,length(email)-4) as "extracted email"
from employees



--list all employees with first_name starts with letters 'A','C' OR 'H'

select first_name
from employees
where first_name like'A%' or
	  first_name like'C%' or
	  first_name like'H%'
order by first_name


--fetch all the first name from the employees table in upper case or lower case

select 
	initcap(first_name)
from employees

--get the first three characters of the first name for all the employees
 
 select substring(first_name,1,3) from employees

--get the unique number of destignations available in employee table

select count(distinct job_id) from employees;
